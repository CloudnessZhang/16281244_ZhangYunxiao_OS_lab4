**实验报告**

>   课程名称：*操作系统*

>   任课教师：*何永忠*

>   学生姓名：*张云肖*

>   学生学号：*16281244*

>   专业年级：*安全1601班*

>   学院名称：*计算机学院*

2018年5月16日

实验名称:页面置换算法
=====================

**班级：安全1601 姓名：张云肖 学号：16281244**

1. 实验目的
-----------

1.  设计和实现最佳置换算法、先进先出置换算法、最近最久未使用置换算法、页面缓冲置换算法、改进的clock算法

2.  通过页面访问序列随机发生器实现对上述算法的测试及性能比较。

2. 概要设计
-----------

### 2.1. 总体设计

当出现缺页异常，需调入新页面而内存已满时，通过页面置换算法选择能够选择被置换的物理页面，从而达到解决上述问题。

页面置换算法的设计目标是尽可能减少页面的调入调出次数，把未来不再访问或短期内不访问的页面调出。

本实验主要功能包括生成页面访问随机序列和页面置换，并输出各个算法的缺页率、算法开销。页面置换算法。其中页面置换可选择最佳置换算法、先进先出置换算法、最近最久未使用置换算法、页面缓冲置换算法、改进的clock算法。

### 2.2. 模块设计

根据实验功能，我们将程序分为5个模块，主要包括选择菜单设计、虚拟页面结构结构设计、页面访问随机序列设计、5种页面置换算法设计、性能分析比较设计。

#### 2.2.1. 选择菜单设计

主函数的功能主要是选择置换算法。能够选择使用最佳置换算法、先进先出算法、最近最久未使用算法、改进型Clock算法、页面缓冲置换算法或者退出。

![](media/dc2d26c0fe4e320f486d1131adb63404.png)

#### 2.2.2. 页面访问随机序列生成设计

##### 1. 模块思路

课程前提假设：模拟的虚拟内存的地址为16位，页面大小为1K；模拟的物理内存为32K。

![](media/c2d6b1794be4a8b2c31d656362b7d663.png)

由于虚拟内存的地址为16位，则系统为进程分配的虚拟地址空间大小为【2\^16B】;根据页面大小为1K，得到物理块数=【2\^16/2\^10=2\^6块】，因此需要页号至少为6位。页号需要【6位】，因此页内偏址需要【16-6=10】位。

##### 2. 模块代码实现

#### 2.2.3. 页面访问随机序列设计

##### 1. 模块思路

1.  确定随机生成访问序列的长度pf_info.total_pn、工作集的起始位置p、工作集中页面数e、工作集移动率m；

2.  生成m个取值范围在p\~p+e之间的随机数，并存放入页面信息的数据中；

3.  生成随机数r，如果r\>t，则为p生成一个新值，否则p=p+1；

4.  如果生成序列数小于pf_info.total_pn，则返回第二步。

##### 2. 模块代码实现

##### 模块实现结果

![](media/86da7517026421f75ce9a2c55c80a3f3.png)

#### 2.2.4. 最佳置换算法

##### 1. 算法简介

1.  基本思想：选择永不使用或是在最长时间内不再被访问（即距现在最长时间才会被访问）的页面淘汰出内存

2.  评价：理想化算法，具有最好性能（对于固定分配页面方式，本法可保证获得最低的缺页率），但实际上却难于实现，故主要用于算法评价参照。

##### 算法举例

假设请求分页存户管理中给进程分配的物理页面为：3，即分配的页框数。

生成的随机页面访问序列为：

4 3 4 2 4 3 2 3 1 4

3 3 5 5 2 4 3 2 2 4

且初始调入页框内不计入缺页。

![](media/8c97562dda3b2e6410737fcd03311a8c.png)

##### 模块代码实现

#### 2.2.5. 先进先出算法

##### 1. 算法简介

基本思想：选择最先进入内存即在内存驻留时间最久的页面换出到外存，进程已调入内存的页面按进入先后次序链接成一个队列，并设置替换指针以指向最老页面

评价：简单直观，但不符合进程实际运行规律，性能较差，故实际应用极少

##### 算法举例

假设请求分页存户管理中给进程分配的物理页面为：3，即分配的页框数。

=============页面访问序列=============

1 3 1 3 2 3 2 4 4 1

3 4 2 4 3 4 3 4 2 5

且初始调入页框内不计入缺页。

![](media/67f816b2504162012457abf1291a2f82.png)

##### 3. 模块代码实现

#### 2.2.6. 最近最久未使用置换算法

##### 1. 算法简介

基本思想：以“最近的过去”作为“最近的将来”的近似，选择最近一段时间最长时间未被访问的页面淘汰出内存

评价：适用于各种类型的程序，性能较好，但需要较多的硬件支持

##### 2. 算法举例

假设请求分页存户管理中给进程分配的物理页面为：3，即分配的页框数。

=============页面访问序列=============

1 1 3 2 2 2 3 1 2 2

15 15 13 12 14 14 12 13 12 14

且初始调入页框内不计入缺页。

![](media/d11b2a48b9574d84dfc2f9a3a4402721.png)

##### 模块代码实现

#### 2.2.7. 改进的clock算法

##### 1. 算法简介

基本思想：

1.  从查寻指针当前位置起扫描内存分页循环队列，选择A=0且M=0的第一个页面淘汰；若未找到，转2)

2.  开始第二轮扫描，选择A=0且M=1的第一个页面淘汰，同时将经过的所有页面访问位置0；若不能找到，转1)

评价：与简单Clock算法相比，可减少磁盘的I/O操作次数，但淘汰页的选择可能经历多次扫描，故实现算法自身的开销增大

##### 算法举例

假设请求分页存户管理中给进程分配的物理页面为：3，即分配的页框数。

=============页面访问序列=============

3 4 2 2 3 3 3 1 3 4

2 4 4 4 5 3 5 5 4 5

且初始调入页框内不计入缺页。

![](media/5a466186a95ac2fee917403ba10b1553.png)

##### 模块代码实现

#### 2.2.8. 页面缓冲置换算法

##### 1. 算法简介

基本思想：

1.  设立空闲页面链表和已修改页面链表

2.  采用可变分配和基于先进先出的局部置换策略，并规定被淘汰页先不做物理移动，而是依据是否修改分别挂到空闲页面链表或已修改页面链表的末尾

3.  空闲页面链表同时用于物理块分配

4.  当已修改页面链表达到一定长度如Z个页面时，一起将所有已修改页面写回磁盘，故可显著减少磁盘I/O操作次数

##### 算法举例

假设请求分页存户管理中给进程分配的物理页面为：3，即分配的页框数。

=============页面访问序列=============

2 2 4 2 4 1 2 4 3 4

15 15 14 15 13 15 14 13 15 14

且初始调入页框内不计入缺页。

![](media/8ba7b5485adb82de39c2b54d66459f04.png)

##### 模块代码实现

#### 2.2.9. 性能分析比较设计

假设随机序列生成长度为20，测试得如下结果

| 算法缺页率 |       |        |       |        |        |
|------------|-------|--------|-------|--------|--------|
| 页框数     | OPT   | FIFO   | LRU   | gClock | PBA    |
| 3          | 5%    | 10%    | 10%   | 10%    | 10%    |
| 4          | 5%    | 15%    | 5%    | 10%    | 20%    |
| 5          | 5%    | 10%    | 10%   | 5%     | 10%    |
| 6          | 0%    | 5%     | 10%   | 0%     | 5%     |
| 平均值     | 3.75% | 10.00% | 8.75% | 6.25%  | 11.25% |

得：算法缺页率为：PBA\>FIFO\>LRU\>gClock\>OPT

| 算法开销/时间 |         |         |       |         |         |
|---------------|---------|---------|-------|---------|---------|
| 页框数        | OPT     | FIFO    | LRU   | gClock  | PBA     |
| 3             | 9.854   | 3.242   | 8.85  | 5.016   | 3.586   |
| 4             | 6.462   | 3.966   | 3.422 | 5.205   | 4.877   |
| 5             | 9.157   | 4.282   | 5.932 | 3.705   | 4.933   |
| 6             | 9.144   | 5.673   | 5.9   | 4.863   | 5.503   |
| 平均值        | 8.65425 | 4.29075 | 6.026 | 4.69725 | 4.69725 |

得算法时间开销为:OPT\>LRU\>gClock\>PBA\>FIFO
